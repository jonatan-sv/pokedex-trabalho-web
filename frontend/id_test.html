<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      type="image/x-icon"
      href="https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Procurar por ID</title>
    <style>
      #container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 10px;
      }

      #container div {
        text-align: center;
      }

      #container img {
        width: 200px;
        height: 200px;
      }

      #container span {
        display: block;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Pokédex</h1>
    <h2>Teste 2: Pesquisar por ID</h2>
    <section id="container">
      <div>
        <img
          id="sprite"
          src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/0.png"
        />
        <span id="name" style="font-weight: bold">???</span>
        <span id="number">#0</span>
      </div>
    </section>
    <br />
    <br />
    <form name="searchByID" method="post">
      Procurar por ID:
      <input
        type="number"
        name="number"
        id="number"
        min="1"
        max="100000"
        placeholder="1"
      />
      <input type="button" value="Pesquisar" onclick="validate(event)" />
    </form>

    <script>
      function validate(event) {
        const id = document.forms["searchByID"]["number"];
        if (id.value <= 0) {
          id.setAttribute("value", 1);
          alert("O valor mínimo é 1!");
        } else {
          teste(event);
        }
      }

      function teste(event) {
        const sprite = document.querySelector("img#sprite");
        const name = document.querySelector("span#name");
        const number = document.querySelector("span#number");
        const id = document.forms["searchByID"]["number"].value;
        const server = `http://localhost:8800/pokemons/${id}`;

        fetch(server)
          .then((response) => {
            if (!response.ok) {
              return response.json().then((error) => {
                throw new Error(JSON.stringify(error));
              });
            }
            return response.json();
          })
          .then((data) => {
            if (data == null) {
              throw new Error("Este Pokémon não existe no banco de dados");
            }
            sprite.src = data.sprite;
            name.textContent = data.name;
            number.textContent = `#${data.number}`;
          })
          .catch((error) => {
            console.error("Erro na requisição:", error.message);
            alert(`Erro na requisição: ${error.message}`);
          });
      }
    </script>
  </body>
</html>
